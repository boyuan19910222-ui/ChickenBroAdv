## 新增需求

### 需求: 回合制战斗
系统应实现回合制战斗机制，玩家和敌人轮流执行行动。

#### 场景: 战斗回合顺序
- **当** 野外战斗开始时
- **那么** 玩家先手攻击，敌人在玩家行动后延迟 1 秒执行回合
- **备注** 副本战斗使用 TurnOrderSystem 基于速度值排序

#### 场景: 玩家行动选择
- **当** 轮到玩家回合时
- **那么** 玩家可以选择：攻击、使用技能（职业专属）、防御或逃跑

### 需求: 战斗环境
系统应支持两种不同的战斗环境：野外和地下城。

#### 场景: 野外战斗
- **当** 玩家在野外区域点击"探索"时
- **那么** 从当前区域怪物列表随机遇敌，通过 CombatSystem 进入 1v1 战斗

#### 场景: 地下城战斗
- **当** 玩家进入副本时
- **那么** 战斗使用 DungeonCombatSystem，支持多人队伍 vs 多敌人/BOSS

### 需求: 战斗伤害反馈
系统应提供视觉反馈，让玩家清楚看到伤害/治疗效果。

#### 场景: 浮动伤害数字
- **当** 攻击命中目标时
- **那么** 目标身上弹出红色伤害数字，上飘 0.8 秒后淡出

#### 场景: 暴击强化动效
- **当** 攻击暴击时
- **那么** 伤害数字更大（22px vs 14px），橙色三层发光阴影，先放大 1.6 倍再缩小飘走，持续 1.2 秒

#### 场景: 受击抖动
- **当** 目标被命中时
- **那么** 普通攻击触发 0.3 秒左右微摇，暴击触发 0.6 秒强烈震动+微缩放

#### 场景: 治疗数字
- **当** 治疗效果生效时
- **那么** 绿色 "+" 数字上飘淡出

### 需求: 状态效果
系统应管理战斗中可以施加给角色的各种状态效果。

#### 场景: 中毒状态效果
- **当** 角色中毒时
- **那么** 角色每回合损失生命值，直到效果过期或被治愈

#### 场景: 眩晕状态效果
- **当** 角色被眩晕时
- **那么** 角色在指定回合数内无法执行行动

### 需求: 战斗界面
系统应以矩形格式显示战斗信息，玩家在左侧，敌人在右侧。

#### 场景: 战斗界面布局
- **当** 战斗开始时
- **那么** 玩家角色（emoji+名称+HP条+资源条+连击点）显示在左侧，敌人（emoji+名称+HP条）显示在右侧，中间显示 "VS"

#### 场景: 生命值和状态显示
- **当** 处于战斗中时
- **那么** 所有参与者的生命条实时更新，血条宽度通过浅拷贝同步确保 Vue 响应式检测

#### 场景: 战斗日志
- **当** 战斗中发生行动时
- **那么** 战斗信息（攻击、伤害、暴击、技能使用）显示在底部系统日志中

### 需求: 战斗结算
系统应根据角色属性和技能计算伤害、治疗和其他战斗效果。

#### 场景: 伤害计算
- **当** 执行攻击时
- **那么** 伤害 = calculateDamage(攻击者stats, 防御者stats, 'physical')，暴击率基于 agility/100（玩家）或 agility/150（敌人），暴击伤害 1.5 倍

#### 场景: 战斗胜利
- **当** 敌人生命值归零时
- **那么** 玩家获得金币（随机范围）和经验值，50% 几率掉落物品

#### 场景: 战斗失败
- **当** 玩家生命值归零时
- **那么** 损失 10% 金币，半血复活（currentHp = maxHp * 0.5）

### 需求: 资源系统
系统应支持不同职业的战斗资源（怒气/能量/法力）。

#### 场景: 怒气生成
- **当** 战士攻击或受到伤害时
- **那么** 根据 GameData.resourceSystems.rage 配置生成怒气，暴击产生双倍怒气
- **并且** 脱战后怒气每秒衰减 2 点

#### 场景: 能量恢复
- **当** 盗贼处于战斗或脱战状态时
- **那么** 能量自动恢复，速率基于 GameData.resourceSystems.energy 配置

#### 场景: 法力恢复
- **当** 法系职业脱战时
- **那么** 法力每秒恢复 1 点

### 需求: 休息恢复
系统应支持探索界面的休息恢复机制。

#### 场景: 渐进式恢复
- **当** 玩家点击"休息"时
- **那么** HP 和资源（非怒气）从当前值线性恢复至满，恢复时长与缺失比例成正比（完整周期 8 秒），50ms 刷新一帧

#### 场景: 怒气不受休息影响
- **当** 战士职业休息时
- **那么** 怒气不被恢复（怒气通过战斗产生，脱战自然衰减）

#### 场景: 满状态检测
- **当** 玩家 HP 和资源都已满时
- **那么** 提示"你精力充沛，不需要休息"
