## ADDED Requirements

### Requirement: generateEquipment produces a complete equipment object
The system SHALL export a `generateEquipment(params)` function that accepts `{ slot, itemLevel, quality, armorType?, weaponType?, weaponHand? }` and returns a complete equipment object compatible with the existing equipment structure.

#### Scenario: Generate a rare chest armor
- **WHEN** `generateEquipment({ slot: 'chest', itemLevel: 20, quality: 'rare', armorType: 'plate' })` is called
- **THEN** the returned object contains: id (unique instanceId), name (string), slot ('chest'), itemLevel (20), quality ('rare'), armorType ('plate'), armorValue (from calcArmorValue), stats (non-empty object with total = budget), durability, sellPrice, requiredLevel

#### Scenario: Generate a one-hand weapon
- **WHEN** `generateEquipment({ slot: 'mainHand', itemLevel: 15, quality: 'uncommon', weaponType: 'sword', weaponHand: 'one_hand' })` is called
- **THEN** the returned object contains: damage (from calcWeaponDamage), weaponType ('sword'), weaponHand ('one_hand'), stats (non-empty), no armorValue

### Requirement: Poor and common quality equipment has no stats
Equipment with quality `poor` or `common` SHALL have an empty stats object `{}`. Only `uncommon` and above SHALL receive stat allocation.

#### Scenario: Poor quality armor
- **WHEN** `generateEquipment({ slot: 'chest', itemLevel: 10, quality: 'poor', armorType: 'cloth' })` is called
- **THEN** stats is `{}`, but armorValue is calculated normally

#### Scenario: Common quality weapon
- **WHEN** `generateEquipment({ slot: 'mainHand', itemLevel: 10, quality: 'common', weaponType: 'sword', weaponHand: 'one_hand' })` is called
- **THEN** stats is `{}`, but damage is calculated normally

#### Scenario: Uncommon quality has stats
- **WHEN** `generateEquipment({ slot: 'chest', itemLevel: 10, quality: 'uncommon', armorType: 'leather' })` is called
- **THEN** stats is non-empty with total points = floor(10 × 1.0 × 1.15) = 11

### Requirement: Accessory slots reject poor and common quality
The system SHALL reject or auto-upgrade quality to `uncommon` when generating equipment for slots `neck`, `finger1`, `finger2`, `trinket1`, `trinket2` with quality `poor` or `common`.

#### Scenario: Trinket with poor quality is upgraded
- **WHEN** `generateEquipment({ slot: 'trinket1', itemLevel: 20, quality: 'poor' })` is called
- **THEN** the returned object has quality `uncommon` (auto-upgraded) and non-empty stats

#### Scenario: Ring with common quality is upgraded
- **WHEN** `generateEquipment({ slot: 'finger1', itemLevel: 15, quality: 'common' })` is called
- **THEN** the returned object has quality `uncommon` and non-empty stats

#### Scenario: Neck with rare quality is unchanged
- **WHEN** `generateEquipment({ slot: 'neck', itemLevel: 20, quality: 'rare' })` is called
- **THEN** the returned object has quality `rare` (no change)

### Requirement: Stat allocation uses slot bias with controlled variance
Stats SHALL be allocated by: selecting 2-3 attributes from the slot's bias pool (weighted random), distributing budget proportionally, then applying ±15% variance per stat. Each allocated stat SHALL be ≥ 1. The total SHALL equal the calculated budget.

#### Scenario: Chest armor stat bias favors stamina
- **WHEN** generating multiple rare chest armors at itemLevel 20
- **THEN** stamina appears in the stats of most generated items (due to high weight in chest bias pool)

#### Scenario: Weapon stat bias favors offensive stats
- **WHEN** generating multiple rare mainHand weapons at itemLevel 20
- **THEN** strength or agility appears in the stats of most generated items

#### Scenario: Stats have controlled variance
- **WHEN** generating two rare chest armors with identical parameters
- **THEN** they MAY have different stat distributions, but each stat is within ±15% of its base allocation, and total equals budget

### Requirement: Equipment name generation uses pool with fallback
Names SHALL be generated by first attempting to pick from a name pool keyed by `{armorType/weaponType}.{slot}`, and falling back to structured concatenation: `{qualityPrefix} {material}{slotName}`.

#### Scenario: Name from pool
- **WHEN** generating a plate chest armor and the name pool has entries for `plate.chest`
- **THEN** the name is randomly selected from the pool entries

#### Scenario: Fallback name generation
- **WHEN** generating equipment for a slot/type combination with no name pool entries
- **THEN** the name is constructed as `{qualityPrefix} {slotName}` (e.g., "精致的 胸甲")

### Requirement: Accessory equipment has no durability
Equipment in slots `neck`, `finger1`, `finger2`, `trinket1`, `trinket2` SHALL have `durability: null`. All other slots SHALL have durability calculated based on itemLevel and quality.

#### Scenario: Ring has no durability
- **WHEN** `generateEquipment({ slot: 'finger1', itemLevel: 20, quality: 'rare' })` is called
- **THEN** durability is null

#### Scenario: Chest armor has durability
- **WHEN** `generateEquipment({ slot: 'chest', itemLevel: 20, quality: 'rare', armorType: 'plate' })` is called
- **THEN** durability is `{ current: X, max: X }` where X > 0

### Requirement: Generator caps at epic quality
The `generateEquipment()` function SHALL NOT produce legendary quality items. If `quality: 'legendary'` is passed, the system SHALL reject or downgrade to epic. Legendary items SHALL only exist as hand-crafted templates.

#### Scenario: Legendary quality is rejected
- **WHEN** `generateEquipment({ slot: 'mainHand', itemLevel: 50, quality: 'legendary' })` is called
- **THEN** the returned object has quality `epic` (downgraded) or an error is thrown
