## Why

当前后端数据层依赖本地数据库与手写 SQL，导致部署环境一致性差、维护成本高、查询安全与可演进性不足。现在需要将数据持久化统一到线上 MySQL，并通过 ORM 标准化数据访问，在不改变现有对外接口行为的前提下提升可维护性与稳定性。

## What Changes

- 将服务端持久化后端从本地数据库切换为线上 MySQL（生产可用连接、连接池、配置化管理）。
- 引入 ORM 库替代手写 SQL，统一模型定义、查询构建、事务与迁移入口。
- 为现有接口建立兼容性约束：请求参数、响应结构、状态码、错误语义保持一致。
- 增加数据库访问层的抽象与适配，确保业务层调用方式稳定，避免上层大规模改动。
- 增加迁移与回滚策略，确保上线切换期间数据完整性与可恢复性。

## Capabilities

### New Capabilities
- `mysql-online-persistence`: 提供面向线上 MySQL 的统一持久化能力，包括连接管理、健康检查与事务支持。
- `orm-data-access-layer`: 提供 ORM 模型与仓储访问模式，替代手写 SQL 并规范 CRUD 与关联查询。
- `api-compatibility-contract`: 定义并验证数据库重构后的接口兼容性契约，确保外部调用无感升级。

### Modified Capabilities
- `player-schema`: 在不改变对外字段语义的前提下，更新玩家数据在 MySQL/ORM 中的持久化映射要求。
- `save-load-sanitize`: 更新存读档数据清洗在 ORM 管道中的执行要求，确保与现有校验行为一致。

## Impact

- 受影响后端模块：`server/db.js`、认证与房间/战斗相关数据访问逻辑、所有直接拼接 SQL 的位置。
- 受影响前端模块：理论上无接口改动；如出现差异，仅允许后端兼容层消化，不向前端泄露。
- 新增依赖：MySQL 驱动与 ORM 库（以及可能的迁移工具）。
- 运维影响：需要线上 MySQL 实例、环境变量管理、备份与回滚预案、发布窗口切换流程。
