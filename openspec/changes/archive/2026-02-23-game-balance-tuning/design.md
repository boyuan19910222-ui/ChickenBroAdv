# Game Balance Tuning Design

## Context

### 当前状态
- **坦克职业基础数据**：战士基础血量 120，每级成长 15；圣骑士基础血量 110，每级成长 14；德鲁伊基础血量 100，每级成长 10
- **满级（假设 60 级）裸装血量估算**：
  - 战士：120 + 59×15 = 1005
  - 圣骑士：110 + 59×14 = 936
  - 德鲁伊：100 + 59×10 = 690
- **装备属性**：毕业装备耐力加成约 100-150 点（估算），血量 = 耐力 × 10
- **最终 BOSS 伤害**：斯坦索姆瑞文戴尔男爵约 85-95 伤害/次

### 目标状态
- 满级毕业装备坦克血量：8000-10000
- 坦克不开技能抗住最终 BOSS 最多 4 次攻击
- 4 次攻击总伤害 ≤ 坦克血量：每次 BOSS 伤害 ≤ 2000-2500

### 约束
- 保持经典魔兽世界风格
- 不破坏现有天赋和装备系统
- 保持各职业特色

## Goals / Non-Goals

**Goals:**
1. 设计新的血量计算公式，使坦克满级毕业血量达到 8000-10000
2. 设计 BOSS 伤害公式，使坦克能抗住 4 次攻击
3. 调整护甲减伤机制，保持坦克职业优势
4. 调整装备耐力属性分配

**Non-Goals:**
- 不修改职业技能机制
- 不修改天赋树结构
- 不修改副本地图和怪物分布
- 不修改 PVP 平衡

## Decisions

### D1: 血量计算公式调整

**当前公式**: `health = baseHealth + stamina × 10`

**新公式**: `health = baseHealth + stamina × staminaHealthCoeff + levelHealthBonus`

其中：
- `staminaHealthCoeff = 20`（耐力转血量系数，从 10 提升到 20）
- `levelHealthBonus = level × 50`（等级奖励血量）
- 坦克职业基础血量提升 50%

**计算示例（60级毕业装备）**:
- 战士基础血量：120 × 1.5 = 180
- 装备耐力：约 200 点（毕业装备）
- 天赋耐力加成：+15%（防护天赋）
- 最终血量 = 180 + (200 × 1.15) × 20 + 60 × 50 = 180 + 4600 + 3000 = **7780**
- 加上套装效果、饰品等 → **约 8000-9000**

**替代方案**: 直接增加每级血量成长
- 缺点：低级坦克血量过高，影响低级副本平衡

### D2: BOSS 伤害公式

**公式**: `bossDamage = baseDamage × difficultyMultiplier × (1 + levelScale)`

其中：
- `baseDamage` = BOSS 等级 × 8（基础伤害）
- `difficultyMultiplier` = 1.0（普通）/ 1.2（困难）/ 1.5（英雄）
- `levelScale` = (BOSS等级 - 50) × 0.05

**计算示例**:
- 瑞文戴尔男爵（60级）：60 × 8 × 1.0 × (1 + 10 × 0.05) = 480 × 1.5 = **720 基础伤害**
- 考虑护甲减伤（板甲约 50%）：实际伤害 **360**
- 4 次攻击总伤害：1440（远低于 8000）

**修正**: BOSS 伤害需要更高
- 最终 BOSS 每次 2000 伤害（护甲后）
- 护甲减伤 50% → 需要原始伤害 4000
- 调整 `baseDamage = BOSS等级 × 50`

**最终 BOSS 伤害计算**:
- 60 级 BOSS：60 × 50 × 1.0 × 1.5 = **4500** 原始伤害
- 护甲减伤 50% 后：**2250** 实际伤害
- 4 次 = 9000（刚好击杀 8000 血坦克）

### D3: 护甲减伤调整

**当前公式**: `reduction% = totalArmor / (totalArmor + K × attackerLevel)`

保持现有公式，调整 K 值：
- 当前 K = 400
- 新 K = 300（使护甲效果更明显）

**效果**:
- 满级板甲坦克护甲约 3000
- 减伤率 = 3000 / (3000 + 300 × 60) = 3000 / 21000 = **14.3%**（太低）

**修正**: 使用更符合 WoW 的护甲公式
- `reduction% = totalArmor / (totalArmor + 85 × attackerLevel + 400)`
- 60 级 BOSS：3000 / (3000 + 85 × 60 + 400) = 3000 / 8500 = **35.3%**
- 需要更高护甲值

**调整装备护甲值**:
- 毕业板甲护甲目标：8000-10000
- 减伤率：8000 / (8000 + 5500) = **59.3%**

### D4: 装备属性调整

**耐力属性分配**:
- 大件（胸甲/腿甲）：耐力 25-35
- 中件（头盔/护肩/手套/靴子）：耐力 18-25
- 小件（手腕/腰带/披风）：耐力 12-18
- 饰品类（项链/戒指/饰品）：耐力 10-15
- 总计：约 200-250 耐力

**护甲值调整**:
- 板甲系数从 5.0 提升到 8.0
- 盾牌系数从 7.5 提升到 12.0
- 品质缩放保持不变

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| 低级副本变简单 | BOSS 伤害公式加入等级缩放，低级 BOSS 伤害适当降低 |
| 非坦克职业血量也提升 | 耐力系数对所有职业生效，但非坦克装备耐力较低 |
| PVP 平衡受影响 | 本次调整仅针对 PVE，PVP 需要单独调校（不在范围） |
| 现有存档数据不兼容 | 提供存档迁移脚本，重新计算属性 |

## Migration Plan

### 阶段 1: 数据修改
1. 更新 `GameData.js` 中的职业基础属性和成长系数
2. 更新 `EquipmentData.js` 中的护甲系数和耐力属性
3. 更新 `MonsterData.js` 中的 BOSS 伤害公式
4. 更新所有副本 BOSS 数据

### 阶段 2: 系统调整
1. 更新 `PlayerSchema.js` 中的属性计算逻辑
2. 更新 `CombatSystem.js` 中的伤害计算

### 阶段 3: 存档迁移
1. 提供存档版本检测
2. 自动重新计算玩家属性

## Open Questions

1. **满级是多少？** 需要确认游戏最高等级（假设 60 级）
2. **毕业装备定义？** 哪些副本掉落的装备算毕业装？
3. **德鲁伊熊形态血量加成？** 熊形态是否有额外血量倍率？
