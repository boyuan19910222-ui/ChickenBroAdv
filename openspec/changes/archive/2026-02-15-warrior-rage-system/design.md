# è®¾è®¡æ–‡æ¡£ï¼šæˆ˜å£«æ€’æ°”ç³»ç»Ÿ

## æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€šç”¨èµ„æºç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  GameData.resourceSystems                                       â”‚
â”‚  â”œâ”€â”€ rage (æ€’æ°”é…ç½®)                                            â”‚
â”‚  â”œâ”€â”€ mana (æ³•åŠ›é…ç½®)                                            â”‚
â”‚  â””â”€â”€ energy (èƒ½é‡é…ç½® - é¢„ç•™)                                    â”‚
â”‚                                                                 â”‚
â”‚  Player.resource                                                â”‚
â”‚  â”œâ”€â”€ type: 'rage' | 'mana' | 'energy'                          â”‚
â”‚  â”œâ”€â”€ current: number                                           â”‚
â”‚  â”œâ”€â”€ max: number                                               â”‚
â”‚  â””â”€â”€ baseMax: number                                           â”‚
â”‚                                                                 â”‚
â”‚  CombatSystem                                                   â”‚
â”‚  â”œâ”€â”€ ResourceManager (æ–°å¢)                                     â”‚
â”‚  â”‚   â”œâ”€â”€ generateResource()                                    â”‚
â”‚  â”‚   â”œâ”€â”€ consumeResource()                                     â”‚
â”‚  â”‚   â””â”€â”€ updateDecay()                                         â”‚
â”‚  â””â”€â”€ ç°æœ‰æˆ˜æ–—é€»è¾‘é›†æˆ                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•°æ®ç»“æ„è®¾è®¡

### 1. èµ„æºç³»ç»Ÿé…ç½® (GameData.js)

```javascript
resourceSystems: {
    rage: {
        displayName: 'æ€’æ°”',
        emoji: 'ğŸ’¢',
        color: '#FF4444',
        defaultMax: 100,
        startValue: 0,
        
        generation: {
            onHit: 5,           // è¢«å‡»ä¸­è·å¾—
            onAttack: 8,        // æ™®é€šæ”»å‡»è·å¾—
            critMultiplier: 1.5 // æš´å‡»å€ç‡
        },
        
        decay: {
            enabled: true,
            delay: 3,           // è„±æˆ˜åå»¶è¿Ÿç§’æ•°
            rate: 2             // æ¯ç§’è¡°å‡é‡
        }
    },
    
    mana: {
        displayName: 'æ³•åŠ›',
        emoji: 'ğŸ’§',
        color: '#4444FF',
        defaultMax: null,       // ç”±å±æ€§è®¡ç®—
        startValue: 'full',
        
        generation: {
            perTurn: 5,
            spiritScaling: 0.5
        },
        
        decay: {
            enabled: false
        }
    }
}
```

### 2. è§’è‰²èµ„æºå­—æ®µ

```javascript
// è§’è‰²åˆ›å»ºæ—¶
player: {
    // ... ç°æœ‰å­—æ®µ
    
    // æ–°å¢é€šç”¨èµ„æº
    resource: {
        type: 'rage',
        current: 0,
        max: 100,
        baseMax: 100
    },
    
    // åºŸå¼ƒå­—æ®µ (ä¿ç•™å…¼å®¹)
    currentMana: 0,    // deprecated
    maxMana: 30        // deprecated
}
```

### 3. æŠ€èƒ½æ¶ˆè€—ç»“æ„

```javascript
// æˆ˜å£«æŠ€èƒ½
heroicStrike: {
    id: 'heroicStrike',
    name: 'è‹±å‹‡æ‰“å‡»',
    resourceCost: {
        type: 'rage',
        value: 15
    },
    // manaCost: åºŸå¼ƒ
}

// æ³•å¸ˆæŠ€èƒ½
fireball: {
    id: 'fireball',
    name: 'ç«çƒæœ¯',
    resourceCost: {
        type: 'mana',
        value: 35
    }
}
```

## æ ¸å¿ƒé€»è¾‘

### æ€’æ°”äº§ç”Ÿæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ€’æ°”äº§ç”Ÿè§¦å‘ç‚¹                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  playerAttack()                                             â”‚
â”‚  â”œâ”€â”€ è®¡ç®—ä¼¤å®³                                               â”‚
â”‚  â”œâ”€â”€ åˆ¤æ–­æš´å‡»                                               â”‚
â”‚  â””â”€â”€ generateResource('attack', isCrit)                     â”‚
â”‚      â”œâ”€â”€ baseGain = config.generation.onAttack (8)         â”‚
â”‚      â”œâ”€â”€ if (isCrit) gain *= critMultiplier (1.5)          â”‚
â”‚      â””â”€â”€ addResource(gain) â†’ rage += 8 æˆ– 12               â”‚
â”‚                                                             â”‚
â”‚  enemyTurn() â†’ æ•Œäººæ”»å‡»ç©å®¶                                  â”‚
â”‚  â””â”€â”€ generateResource('damaged')                            â”‚
â”‚      â””â”€â”€ addResource(config.generation.onHit) â†’ rage += 5  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ€’æ°”æ¶ˆè€—æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŠ€èƒ½ä½¿ç”¨æµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  playerUseSkill(skillId)                                    â”‚
â”‚  â”œâ”€â”€ skill = GameData.skills[skillId]                      â”‚
â”‚  â”œâ”€â”€ cost = skill.resourceCost                             â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ if (cost.type !== player.resource.type)               â”‚
â”‚  â”‚   â””â”€â”€ return error "èµ„æºç±»å‹ä¸åŒ¹é…"                      â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€â”€ if (player.resource.current < cost.value)             â”‚
â”‚  â”‚   â””â”€â”€ return error "æ€’æ°”ä¸è¶³"                            â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€â”€ player.resource.current -= cost.value                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æˆ˜æ–—åˆå§‹åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æˆ˜æ–—å¼€å§‹å¤„ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  startCombat(enemyId)                                       â”‚
â”‚  â”œâ”€â”€ åœæ­¢è„±æˆ˜è®¡æ—¶ outOfCombatTime = null                    â”‚
â”‚  â”‚   â””â”€â”€ é˜²æ­¢æ€’æ°”ç»§ç»­è¡°å‡                                    â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€â”€ æ‰€æœ‰èµ„æºç±»å‹ä¿æŒå½“å‰å€¼                                  â”‚
â”‚      â”œâ”€â”€ æ€’æ°”ï¼šç»§æ‰¿å½“å‰å€¼ï¼ˆè¿ç»­æˆ˜æ–—ä½“éªŒä¼˜åŒ–ï¼‰                 â”‚
â”‚      â””â”€â”€ æ³•åŠ›ï¼šä¿æŒå½“å‰å€¼                                    â”‚
â”‚                                                             â”‚
â”‚  æ€’æ°”å½’é›¶é€”å¾„ï¼š                                              â”‚
â”‚  â””â”€â”€ ä»…é€šè¿‡è„±æˆ˜è¡°å‡æœºåˆ¶ï¼ˆ3ç§’å»¶è¿Ÿï¼Œæ¯ç§’-2ï¼‰                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è„±æˆ˜è¡°å‡æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ€’æ°”è¡°å‡æ—¶åº                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æˆ˜æ–—ç»“æŸ                                                    â”‚
â”‚  â””â”€â”€ outOfCombatTime = Date.now()                          â”‚
â”‚                                                             â”‚
â”‚  update(deltaTime) æ¯å¸§è°ƒç”¨                                  â”‚
â”‚  â”œâ”€â”€ if (!inCombat && resourceType === 'rage')             â”‚
â”‚  â”‚   â”œâ”€â”€ elapsed = now - outOfCombatTime                   â”‚
â”‚  â”‚   â”‚                                                      â”‚
â”‚  â”‚   â”œâ”€â”€ if (elapsed < decay.delay * 1000)                 â”‚
â”‚  â”‚   â”‚   â””â”€â”€ return (å»¶è¿ŸæœŸé—´ä¸è¡°å‡)                        â”‚
â”‚  â”‚   â”‚                                                      â”‚
â”‚  â”‚   â””â”€â”€ if (resource.current > 0)                         â”‚
â”‚  â”‚       â””â”€â”€ resource.current -= decay.rate * deltaTime    â”‚
â”‚  â”‚                                                          â”‚
â”‚  â””â”€â”€ è¿›å…¥æˆ˜æ–—æ—¶åœæ­¢è¡°å‡                                      â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI é€‚é…

### èµ„æºæ¡ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ ¹æ® player.resource.type æ¸²æŸ“ä¸åŒæ ·å¼                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  æˆ˜å£«:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ ğŸ’¢ æ€’æ°”  35 / 100                  â”‚                     â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  (çº¢è‰² #FF4444)     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â”‚  æ³•å¸ˆ:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ ğŸ’§ æ³•åŠ›  150 / 200                 â”‚                     â”‚
â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  (è“è‰² #4444FF)     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…¼å®¹æ€§å¤„ç†

### è¿ç§»ç­–ç•¥

1. æ–°å»ºè§’è‰²ä½¿ç”¨ `resource` å¯¹è±¡
2. æ—§å­˜æ¡£æ£€æµ‹ï¼šå¦‚æœæ²¡æœ‰ `resource` å­—æ®µï¼Œæ ¹æ®èŒä¸šè‡ªåŠ¨è¿ç§»
3. `currentMana/maxMana` ä¿ç•™ä½†æ ‡è®° deprecated

```javascript
// å­˜æ¡£åŠ è½½æ—¶çš„è¿ç§»é€»è¾‘
function migratePlayerResource(player) {
    if (player.resource) return player; // å·²è¿ç§»
    
    const classData = GameData.classes[player.class];
    const resourceType = classData.resourceType || 'mana';
    
    player.resource = {
        type: resourceType,
        current: resourceType === 'mana' ? player.currentMana : 0,
        max: resourceType === 'mana' ? player.maxMana : 100,
        baseMax: resourceType === 'mana' ? player.maxMana : 100
    };
    
    return player;
}
```

## å¤©èµ‹ç³»ç»Ÿæ¥å£

é¢„ç•™å¤©èµ‹ä¿®æ”¹èµ„æºä¸Šé™çš„æ¥å£ï¼š

```javascript
// TalentSystem.applyTalentEffects() ä¸­
case 'modifyResourceMax':
    if (effect.resourceType === player.resource.type) {
        player.resource.max = player.resource.baseMax + (effect.valuePerRank * rank);
    }
    break;
```
