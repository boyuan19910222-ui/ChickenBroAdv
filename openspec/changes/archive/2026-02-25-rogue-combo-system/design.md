## Context

当前游戏已实现战士怒气系统（战斗中积累、脱战衰减）和法师法力系统（满值开始、回合恢复）。盗贼虽配置使用能量（energy），但缺少其标志性的连击点机制。

连击点是魔兽世界盗贼的核心玩法：
- 使用常规技（Builder）积累连击点
- 使用终结技（Finisher）消耗连击点，点数越多威力越大
- 形成"积累→释放"的战斗节奏

## Goals / Non-Goals

**Goals:**
- 实现连击点核心机制（产生、消耗、上限）
- 实现阶梯式终结技伤害缩放
- 实现能量战斗中回合恢复
- 实现能量脱战后恢复
- 提供 2 个测试技能验证流程：影袭（Builder）、剔骨（Finisher）
- UI 显示连击点状态（●●●○○）

**Non-Goals:**
- 天赋系统交互（后续单独处理）
- 数值平衡调优（后续单独处理）
- 完整盗贼技能列表（本次仅 2 个测试技能）
- 连击点绑定目标（采用简化方案：绑定玩家）

## Decisions

### 1. 连击点绑定方式

**决策**: 连击点绑定玩家，而非目标

**备选方案**:
- A) 绑定目标（WoW 经典）：切换目标丢失连击点
- B) 绑定玩家（简化）：切换目标保留连击点

**理由**: 当前游戏是回合制单目标战斗，绑定目标的策略意义不大。简化方案降低复杂度，后续如有多目标战斗需求可再扩展。

### 2. 终结技伤害缩放方式

**决策**: 阶梯式缩放（每个技能独立伤害表）

**备选方案**:
- A) 线性缩放：伤害 = 基础 × 连击点数
- B) 超线性缩放：伤害 = 基础 × (点数 + 0.2 × 点数²)
- C) 阶梯式：每个技能有独立的 5 级伤害表

**理由**: 阶梯式提供最大的设计灵活性，每个终结技可以有不同的缩放曲线。也便于后续平衡调整。

### 3. 能量恢复时机

**决策**: 玩家回合结束时恢复 +15

**备选方案**:
- A) 回合开始时恢复
- B) 回合结束时恢复
- C) 每个回合（包括敌人）都恢复

**理由**: 回合结束恢复使第一回合需要用初始能量，增加开局决策。100 起始能量足够使用 2 个技能。

### 4. 数据结构扩展

**决策**: 在 Player 对象添加 `comboPoints` 子对象

```javascript
player.comboPoints = {
    current: 0,    // 当前连击点 (0-5)
    max: 5         // 上限（可被天赋提升）
}
```

**理由**: 与 `player.resource` 结构保持一致，便于天赋系统后续扩展 `max` 值。

### 5. 技能分类标识

**决策**: 在技能数据添加 `category` 字段

```javascript
skill = {
    category: 'builder' | 'finisher' | 'utility',
    comboPointsGenerated: 1,        // Builder 专用
    requiresComboPoints: true,      // Finisher 专用
    comboPointsDamage: [...]        // Finisher 伤害表
}
```

**理由**: 显式分类便于 UI 展示和战斗逻辑处理。

## 实现偏差记录

### 1. 盗贼技能列表变更
**规格**: `[shadowStrike, eviscerate, evade]`
**实际**: `[backstab, shadowStrike, eviscerate]`
- 新增了 `backstab`（背刺）— 2 点能量消耗的后方攻击技能
- 移除了 `evade`（闪避）— 后续迭代可补回
- 原因：backstab 更符合盗贼核心玩法，evade 为防御型技能优先级较低

### 2. 连击点 UI 显示格式
**规格**: `🗡️ 连击: ●●●○○` + 数字 `3/5`
**实际**: `🗡️ 连击点` 标签 + `⭐⭐⭐☆☆` 星号显示 + `3/5` 数字显示
- 星号格式在游戏像素风格中视觉效果更好
- 前缀文本改为"🗡️ 连击点"
- 数字显示已实现（CharacterPanel 中 `.combo-numbers`）

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| 连击点不绑定目标，后续多目标战斗扩展困难 | 当前为 MVP，记录设计决策，后续可重构 |
| 阶梯式伤害数据量大 | 先实现 2 个技能验证，后续再批量添加 |
| 能量恢复数值可能不平衡 | 暂定 +15/回合，后续根据测试调整 |
| 存档迁移遗漏 | 沿用 resource-system 的迁移模式 |

## 战斗流程示意

```
┌─────────────────────────────────────────────────────────────┐
│  战斗开始: 能量 100/100, 连击点 ○○○○○                       │
├─────────────────────────────────────────────────────────────┤
│  回合1: 影袭 → -40能量, +1连击 → 60/100, ●○○○○             │
│  回合结束: +15能量 → 75/100                                 │
├─────────────────────────────────────────────────────────────┤
│  回合2: 影袭 → -40能量, +1连击 → 35/100, ●●○○○             │
│  回合结束: +15能量 → 50/100                                 │
├─────────────────────────────────────────────────────────────┤
│  回合3: 影袭 → -40能量, +1连击 → 10/100, ●●●○○             │
│  回合结束: +15能量 → 25/100                                 │
├─────────────────────────────────────────────────────────────┤
│  回合4: 普攻（能量不足）                                     │
│  回合结束: +15能量 → 40/100                                 │
├─────────────────────────────────────────────────────────────┤
│  回合5: 剔骨(3点) → -35能量, -3连击 → 5/100, ○○○○○         │
│  造成: 150 + 敏捷×1.2 伤害                                  │
│  回合结束: +15能量 → 20/100                                 │
└─────────────────────────────────────────────────────────────┘
```
